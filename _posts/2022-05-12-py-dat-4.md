---
use_math: true
layout: post
title:  "4: 테스팅"
date:   2022-05-12-15-03
categories: 파이썬_자료구조_첫걸음
---
*이 카테고리는 North Carolina State University 소속 Don Sheehy의 오픈 소스 교재 [A First Course on Data Structures in Python](https://github.com/donsheehy/datastructures)을 읽으며 필기한 것이다.*

파이썬은 인터프리터 언어다. 이는 덕 타이핑과 같은 유연성을 부여한다. 다만 이로 인해 여러 버그가 나타나기도 한다. 그런데 모든 버그가 에러를 산출하는 것도 아니다. 올바른 코드를 작성하려면 우리는 두 가지를 결정해야 한다.

1. **작동하는가?** 즉, 코드가 마땅히 해야 할 일을 하는가?
2. **여전히 작동하는가?** 당신이 남긴 변화가 코드의 다른 부분으로 하여금 깨트리지 않는다고 장담할 수 있는가?

## 4.1 테스트 작성하기

코드 테스팅이란 무엇인가? 바로 동작이 예상과 부합하도록 확인하는 코드를 부가적으로 작성하는 것을 뜻한다. 여기서 동작, 즉 행태(behavior)를 확인하는 것이지 구현(implementation)을 확인하는 것이 아니라는 점에 주의하라.

```python
class Doubler:
    def __init__(self, n):
        self._n = 2 * n
        def n(self):
            return self._n
    
    if __name__ == '__main__':
        x = Doubler(5)
        assert(x.n() == 10)
        y = Doubler(4)
        assert(y.n() == -8)
```

이어지는 술부가 `False`일 경우 `assert` 문장은 오류를 제기할 것이다. 아니라면, 프로그램은 평소처럼 진행될 것이다. `assert`는 일반적인 출력보다 훨씬 낫다. 왜냐하면 출력되리라고 예상하는 바를 매번 확인할 필요가 없기 때문이다.

`if __name__ == '__main__':` 라인은 모듈이 다른 곳에서 import되었을 때 테스트가 실행되지 않을 것임을 보장하기 위한 것이다.

## 4.2 `unittest`로 유닛 테스팅하기

작은 프로그램에는 위 방법이 적합할 수 있겠지만 더 진지한 프로그램에는 **유닛 테스트**(unit test)가 필요하다. 여기서 *유닛*이란 단일의 독자적인 경우 하나를 일컫는다. 따라서 유닛 테스트는 특정 함수의 특정 행태를 테스트하기 위한 것이다. 이는 코드를 변경할 때마다 테스트를 돌려야 한다는 것을 뜻한다.

파이썬에는 `unittest`라는 표준 패키지가 있다. 실제 테스트는 `unittest.TestCase` 클래스 내부의 메소드가 될 것이다. 모든 테스트 메소드는 `test`라는 단어로 시작한다. 테스트는 `unittest.main` 함수를 호출하는 것으로 시작한다.

```python
import unittest
from dayoftheweek import DayOfTheWeek

class TestDayOfTHeWeek(unittest.TestCase):
    def testinitwithabbreviation(self):
        d = DayOfTheWeek('F')
        self.assertEquals(d.name(), 'Friday')

        d = DayOfTheWeek('Th')
        self.assertEquals(d.name(), 'Thursday')

unittest.main()
```

## 4.3 테스트 기반 개발

**TDD**(Test-Driven Development)는 코드 작성 이전에 테스트를 작성할 수 있냐는 발상에 기초한다. 하지만 코드가 아직 작성되지 않았다면 테스트가 실패하지 않겠는가? 만약 좋은 테스트라면 그럴 것이다. 통과하면 어떨 것인가? 그렇다면 테스트에 문제가 있는 것이다.

테스트 작성은 두 가지 행동을 강제한다.

1. 함수를 어떻게 사용하고자 하는지 결정한다. 매개변수는 어때야 하는가? 무엇을 반환해야 하는가?
2. 필요한 코드만 작성한다. 테스트에서 요구하는 행동을 지원하는 코드가 아니라면 작성할 필요가 없다.

**레드-그린-리팩터**(Red-Green-Refactor)랄 것이 있다. 테스팅 절차의 세 단계를 말한다.

- 레드: 테스트가 실패한다. 그래야 한다! 아직 코드를 작성하지 않았기 때문이다!
- 그린: 코드를 수정함으로써 테스트가 통과하도록 한다.
- 리팩터: 중복을 제거하며 코드를 정돈한다.

## 4.4 무엇을 테스트할 것인가

> 컴퓨터에서 떨어져라. 해결하고자 하는 문제를 고찰하라. 작성하려는 방법을 사고하라. 스스로 물어라. *내가 이 코드를 실행할 때 무슨 일이 일어날 것인가?* 또 스스로 물어라. 나는 이 코드를 어떻게 사용하고자 하는가?

- 사용되어 마땅한 방식으로 코드를 사용하는 테스트를 작성하라.
- 그런 다음 코드가 *영광스럽게 실패하는지* 테스트하기 위해 코드를 올바르지 않게 사용하는 테스트를 작성하라.
- *엣지 케이스*(edge case)를 테스트하라. 코드를 스스로 깨라.
- 버그를 테스트로 전환하라. 특수한 테스트를 작성해 버그를 드러낸 다음 고쳐라.
- 퍼블릭 인터페이스를 테스트하라. 당신은 테스트 코드를 클래스의 사용자로서 다뤄야 한다.

## 4.5 테스팅과 객체 지향 설계

클래스들은 종종 상속이나 결합으로 환원되는 관계를 지니고 클래스들은 퍼블릭 메소드를 지닌다. 이들 퍼블릭 메소드를 클래스에 대한 **인터페이스**(interface)라고 부른다. 

설계를 시작하려면 우리는 문제를 살피고 명사를 (클래스를) 식별하고 동사를 (메소드를) 식별한다. 우리의 기술에서 우리는 일어나 *마땅한(should)* 일을 표현한다. 이는 `if...then` 꼴로 표현된다. 즉 `If` 내가 이 메소드를 이들 매개변수로 호출하면 `then` 이것이 일어날 것이다. 이때 유닛 테스트가 코드의 실제 행태와 예상되는 행태를 연결지을 것이다.

